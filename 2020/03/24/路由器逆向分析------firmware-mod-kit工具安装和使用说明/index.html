<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>路由器逆向分析------firmware-mod-kit工具安装和使用说明 | Cyberangel-blog</title><meta name="author" content="Cyberangel"><meta name="copyright" content="Cyberangel"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="本文博客地址：http:&#x2F;&#x2F;blog.csdn.net&#x2F;qq1084283172&#x2F;article&#x2F;details&#x2F;68061957 一、firmware-mod-kit 工具的安装**firmware-mod-kit 工具的功能和 binwalk 工具的类似，其实 firmware-mod-kit 工具在功能上有调用 binwalk 工具提供的功能以及其他的固件解包工具的整合。下载 firmwar">
<meta property="og:type" content="article">
<meta property="og:title" content="路由器逆向分析------firmware-mod-kit工具安装和使用说明">
<meta property="og:url" content="https://cyberangel.cn/2020/03/24/%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%86%E5%90%91%E5%88%86%E6%9E%90------firmware-mod-kit%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/index.html">
<meta property="og:site_name" content="Cyberangel-blog">
<meta property="og:description" content="本文博客地址：http:&#x2F;&#x2F;blog.csdn.net&#x2F;qq1084283172&#x2F;article&#x2F;details&#x2F;68061957 一、firmware-mod-kit 工具的安装**firmware-mod-kit 工具的功能和 binwalk 工具的类似，其实 firmware-mod-kit 工具在功能上有调用 binwalk 工具提供的功能以及其他的固件解包工具的整合。下载 firmwar">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2020-03-24T03:05:45.000Z">
<meta property="article:modified_time" content="2021-07-04T09:57:21.257Z">
<meta property="article:author" content="Cyberangel">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://cyberangel.cn/2020/03/24/%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%86%E5%90%91%E5%88%86%E6%9E%90------firmware-mod-kit%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '路由器逆向分析------firmware-mod-kit工具安装和使用说明',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-07-04 17:57:21'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const fontSizeVal = saveToLocal.get('global-font-size')
    if (fontSizeVal !== undefined) {
      document.documentElement.style.setProperty('--global-font-size', fontSizeVal + 'px')
    }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Cyberangel-blog" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">317</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Cyberangel-blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">路由器逆向分析------firmware-mod-kit工具安装和使用说明</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-03-24T03:05:45.000Z" title="发表于 2020-03-24 11:05:45">2020-03-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-07-04T09:57:21.257Z" title="更新于 2021-07-04 17:57:21">2021-07-04</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">2.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>12分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="路由器逆向分析------firmware-mod-kit工具安装和使用说明"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><span class="disqus-comment-count"><a href="https://cyberangel.cn/2020/03/24/%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%86%E5%90%91%E5%88%86%E6%9E%90------firmware-mod-kit%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/#disqus_thread"></a></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>本文博客地址：<a target="_blank" rel="noopener" href="http://blog.csdn.net/qq1084283172/article/details/68061957">http://blog.csdn.net/qq1084283172/article/details/68061957</a></p>
<p><strong>一、firmware-mod-kit 工具的安装</strong><br>**<br>firmware-mod-kit 工具的功能和 binwalk 工具的类似，其实 firmware-mod-kit 工具在功能上有调用 binwalk 工具提供的功能以及其他的固件解包工具的整合。下载 firmware-mod-kit 工具的源码进入到 src 目录下就能够看到 firmware-mod-kit 工具整合了那些固件提取和文件系统解压的工具。firmware-mod-kit 工具的功能有固件文件的解包和打包、固件提取文件系统的解压和压缩、DD-WRT Web Pages 的修改等，在每个整合的固件分析工具的源码文件夹里都有相关的使用说明。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243425-61874fa3-f91c-4e43-9da4-a57d9bc38af6.png#align=left&display=inline&height=780&originHeight=780&originWidth=698&size=0&status=done&style=none&width=698"></p>
<p><strong>1.在 ubuntu 系统上安装 firmware-mod-kit 工具之前需要先安装需要的依赖库文件。</strong><br>具体可以参考 firmware-mod-kit 工具的官方说明文档：<a target="_blank" rel="noopener" href="https://code.google.com/archive/p/firmware-mod-kit/wikis/Documentation.wiki">https://code.google.com/archive/p/firmware-mod-kit/wikis/Documentation.wiki</a>。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243404-cba31d0d-7739-4b2c-8fc0-da501f1a62c7.png#align=left&display=inline&height=318&originHeight=318&originWidth=784&size=0&status=done&style=none&width=784"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># For Ubuntu 需要安装的依赖库文件</span><br><span class="line">$ sudo apt-get install git build-essential zlib1g-dev liblzma-dev python-magic</span><br></pre></td></tr></table></figure>

<p><strong>2.firmware-mod-kit 工具的下载和安装.</strong><br>firmware-mod-kit 工具的 github 源码下载地址：<a target="_blank" rel="noopener" href="https://github.com/mirror/firmware-mod-kit">https://github.com/mirror/firmware-mod-kit</a>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mirror/firmware-mod-kit.git</span><br><span class="line"># 进入源码目录</span><br><span class="line">cd firmware-mod-kit/src</span><br><span class="line"># 执行configure文件生成Makefile文件然后make编译生成可执行文件</span><br><span class="line">./configure &amp;&amp; make</span><br></pre></td></tr></table></figure>

<p><strong>3.firmware-mod-kit 工具官方的详细说明教程</strong><br>firmware-mod-kit 工具官方详细说明教程的参考网址为：<a target="_blank" rel="noopener" href="https://bitsum.com//firmware_mod_kit.htm">https://bitsum.com//firmware_mod_kit.htm</a>，该网页中详细的说明了 firmware-mod-kit 工具运行支持的平台，整合的固件解包和分析的工具、支持分析的路由器的固件型号以及使用的命令行参数的说明。</p>
<p><strong>4.设备固件分析的讨论</strong><br>有关路由器等设备固件分析讨论的论坛：<a target="_blank" rel="noopener" href="https://forum.bitsum.com/forum/index.php/board,12.html">https://forum.bitsum.com/forum/index.php/board,12.html</a>，该论坛里有很多的有关固件提取、解压、修改、工具交流的信息。</p>
<p><strong>二、firmware-mod-kit 工具的使用说明</strong><br><strong>1.firmware-mod-kit 工具的官方功能描述（有些功能去掉了）</strong>：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019244498-09b2b97d-6726-4185-8617-bc1f58c6f7a4.png#align=left&display=inline&height=276&originHeight=276&originWidth=602&size=0&status=done&style=none&width=602"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243376-e2234b7e-9e25-43e9-b8ce-a52c47cb1f72.png#align=left&display=inline&height=658&originHeight=658&originWidth=608&size=0&status=done&style=none&width=608"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243404-29b93fb2-62d4-432c-beab-ae4c37de3d2f.png#align=left&display=inline&height=505&originHeight=505&originWidth=609&size=0&status=done&style=none&width=609"><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243413-b6eb48a8-1a00-402b-84b7-464dd6956dc3.png#align=left&display=inline&height=394&originHeight=394&originWidth=611&size=0&status=done&style=none&width=611"></p>
<p><strong>2.firmware-mod-kit 工具提供的功能对应的脚本.</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019244345-4ea92bc2-7699-4bda-926d-2436cdd1e829.png#align=left&display=inline&height=478&originHeight=478&originWidth=684&size=0&status=done&style=none&width=684"></p>
<p><strong>3.firmware-mod-kit 工具的功能简单介绍</strong><br><strong>3.1.解包固件提取内核和文件系统</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019244519-d7b9ea93-0238-47be-a485-1644db27f1df.png#align=left&display=inline&height=130&originHeight=130&originWidth=638&size=0&status=done&style=none&width=638"></p>
<h3 id="The-Firmware-Working-Directory"><a href="#The-Firmware-Working-Directory" class="headerlink" title="The Firmware Working Directory"></a>The Firmware Working Directory</h3><p>The Firmware Mod Kit uses a ‘hard coded’ working directory of ‘fmk’. The extraction script extracts to this folder, and the rebuild script rebuilds from this folder. Allowance of alternate working directories is supported for some operations, but not all. We’ll be expanding that in the future. For now, if you have multiple working directories, we suggest you rename the ones you’re not currently operating on.</p>
<h3 id="Extracting-Firmware"><a href="#Extracting-Firmware" class="headerlink" title="Extracting Firmware"></a>Extracting Firmware</h3><p>Automated firmware extraction typically works with most firmware images that employ uImage/TRX firmware headers and use SquashFS or CramFS file systems. Currently, extract-firmware.sh is the preferred method of extraction as it supports more firmware types than the older old-extract.sh script. However, old-extract.sh is still included and works with many firmware formats.<br>Usage for both extract-firmware.sh and extract_firmware.sh is straight forward:<br><code>$ ./extract-firmware.sh firmware.bin</code><br>By default, output from extract-firmware.sh will be located in the ‘fmk’ directory, while old-extract.sh will place extracted data into the specified working directory.</p>
<p><strong>3.2.重打包解包的内核和文件系统重建固件文件</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243420-f344148f-e48c-4d94-bbb3-3081d61cd712.png#align=left&display=inline&height=134&originHeight=134&originWidth=744&size=0&status=done&style=none&width=744"></p>
<h3 id="Re-Building-Firmware"><a href="#Re-Building-Firmware" class="headerlink" title="Re-Building Firmware"></a>Re-Building Firmware</h3><p>Which build script to use is dependant on which extraction script was used. If you extracted a firmware image with extract-firmware.sh, then you must use build-firmware.sh to re-build it. Likewise, if old-extract.sh was used, then old-build.sh must be invoked when re-building an image:<br><code>$ ./build-firmware.sh [-nopad] [-min]</code><br>The new firmware generated by build-firmware.sh will be located at ‘fmk/new-firmware.bin’, while old-build.sh will generate firmware images in several different formats and save them in the specified output directory.<br>The optional -nopad switch will instruct build-firmware.sh to NOT pad the firmware up to its original size.<br>The optional -minswitch will use the maximum squashfs block size of 1MB. This will decrease the firmware image size at the cost of additional CPU and RAM resources utilized on the target device. Do not use this switch unless you must. This is a very large block size for embedded systems. The original firmware squashfs block size is preserved on rebuild, and the original block size should be the one used unless you are sure you know what you’re doing. Too large a block size may appear to work fine, but runtime performance of the firmware may suffer in all or some loads.</p>
<p><strong>3.3.修改  DD-WRT Web Pages 面</strong><br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019244018-07b269b1-ef96-4aff-84d6-bb53da030ba7.png#align=left&display=inline&height=245&originHeight=245&originWidth=735&size=0&status=done&style=none&width=735"></p>
<h3 id="Modifying-DD-WRT-Web-Pages"><a href="#Modifying-DD-WRT-Web-Pages" class="headerlink" title="Modifying DD-WRT Web Pages"></a>Modifying DD-WRT Web Pages</h3><p>One very unique feature of the Firmware Mod Kit is its ability to extract and rebuild files from the DD-WRT Web GUI. This is automated by the ddwrt-gui-extract.sh and ddwrt-gui-restore.sh scripts.<br>Once you have extracted a DD-WRT firmware image using extract-firmwware.sh, you can extract the Web files by running:<br><code>$ ./ddwrt-gui-extract.sh</code><br>This will create a directory named ‘www’ and extract the Web files there. You may modify the files any way you like, but you cannot add or delete files.<br>When you are finished editing, you can rebuild the Web files by running:<br><code>$ ./ddwrt-gui-rebuild.sh</code></p>
<p><strong>3.4.解压 cpio、cramfs、squashfs 格式的文件系统</strong><br>当然了，在 firmware-mod-kit 工具的源码文件夹里仔细看看，能发现 cpio、cramfs、squashfs 格式的文件系统的压缩工具。<br><img src="https://cdn.nlark.com/yuque/0/2020/png/574026/1585019243395-f987380b-de84-4256-b58b-336d7e704a52.png#align=left&display=inline&height=182&originHeight=182&originWidth=687&size=0&status=done&style=none&width=687"></p>
<p><strong>3.5.使用 firmware-mod-kit 工具修改设备固件然后重打包</strong></p>
<h3 id="Reverting-to-a-vendor-firmware"><a href="#Reverting-to-a-vendor-firmware" class="headerlink" title="Reverting to a vendor firmware"></a>Reverting to a vendor firmware</h3><p>Sometimes you’ll enthusiastically flash a third-party firmware like Gargoyle or DD-WRT only to discover it lacks features you need, doesn’t perform as well as the vendor firmware, or has functional problems. In this situation, you might find yourself wanting to go back to the vendor firmware, but have no way to do so!<br>Here’s how the Firmware Mod Kit can help you revert to a vendor firmware. The process is this:</p>
<ol>
<li>Extract vendor firmware. Then rename the ‘fmk’ directory.</li>
<li>Extract third-party ‘upgrade’ firmware (e.g. Gargoyle-sysupgrade)</li>
<li>Replace extracted third-party firmware’s rootfs and image_parts with those from the vendor firmware.</li>
<li>Rebuild firmware image</li>
<li>Flash vendor firmware image (now packaged as your third-party firmware expects).</li>
<li>If all succeeded, you’re now using the vendor firmware again.</li>
</ol>
<p>Once you are back to the vendor firmware, then it accepts vendor firmware images again.</p>
<h3 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h3><p>This example demonstrates how to extract a firmware image, replace its existing telnet daemon with a custom built one, and then build a new firmware image:<br><code>$ ./extract-firmware.sh firmware.bin </code><br><code>$ cp new-telnetd fmk/rootfs/usr/sbin/telnetd </code><br><code>$ ./build-firmware.sh</code><br>Below is an example of the commands to run in order to extract a DD-WRT firmware image, modify the Web index page, and build a new firmware image:<br><code>$ ./extract-firmware.sh firmware.bin </code><br><code>$ ./ddwrt-gui-extract.sh </code><br><code>$ echo &quot;HELLO WORLD&quot; &gt; www/index.asp </code><br><code>$ ./ddwrt-gui-rebuild.sh </code><br><code>$ ./build-firmware.sh</code></p>
<p><strong>3.6.firmware-mod-kit 工具的其它功能</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Making changes to the firmware&#x27;s file system</span><br><span class="line">Modifying the firmware is simple. The file system is stored in the working directory you supplied to extract_firmware.sh. Here are the subfolders of this directory:</span><br><span class="line">    rootfs/</span><br><span class="line">        This is where the file system is. Make modifications here.</span><br><span class="line">    image_parts/</span><br><span class="line">        This is where intermediate files are stored. If you need to replace the kernel (not at all recommended), you can do so by replacing the appropriate file here (usually segment2).</span><br><span class="line">    installed_packages/</span><br><span class="line">        If you use the ipkg_install.sh tool, this is where packages you&#x27;ve installed after firmware extraction will reside.</span><br><span class="line">One can manually change the files in rootfs and/or use the automated package scripts.</span><br><span class="line"></span><br><span class="line">Installing packages (.IPK)</span><br><span class="line">In compliment to manually making changes, one can use pre-built IPKG format package files with the ipkg_install/remove scripts. Although not all will work and a repository for packages verified to work has not yet been produced, many packages work just fine.</span><br><span class="line">Packages are pre-built collections of files pertaining to a set of software. OpenWrt and DD-WRT both use packages, and most are cross-compatible. These packages are stored in a tar/gzip archive of a pre-defined structure that includes some control files. You can extract and copy the files manually, or use the ipkg_install.sh script included with this kit. For a list of some of the available packages (not all may work), see http://downloads.openwrt.org/whiterussian/packages/ and http://ftp.selfnet.de/pub/openwrt/backports/rc5/ . We are currently in the process of compiling a set of packages known to be good for DD-WRT ... to help in this matter please visit here.</span><br><span class="line">For information on how to create IPKs, see the IPK Creation Kit.</span><br><span class="line">Example use:</span><br><span class="line">$ ./ipkg_install.sh some_package-1.2.5.ipk working_directory/</span><br><span class="line"></span><br><span class="line">some_package-1.2.5.ipkg would be the filename of the package.</span><br><span class="line">working_directory is the same working directory you supplied to the extract_firmware.sh script.</span><br><span class="line">Notes:</span><br><span class="line">A script, ipkg_install_all.sh is also available to install an entire folder of packages.</span><br><span class="line">The collection of installed packages will be stored in working_directory/installed_packages .</span><br><span class="line"></span><br><span class="line">Removing packages (.IPK)</span><br><span class="line">To remove packages there is the ipkg_remove.sh script.</span><br><span class="line">Example use:</span><br><span class="line">$ ./ipkg_remove.sh some_package-1.2.5.ipk working_directory/</span><br><span class="line"></span><br><span class="line">some_package-1.2.5.ipkg would be the filename of the package.</span><br><span class="line">working_directory is the same working directory you supplied to the extract_firmware.sh script.</span><br><span class="line">Notes:</span><br><span class="line">A script, ipkg_remove_all.sh is also available to install an entire folder of packages.</span><br></pre></td></tr></table></figure>

<h3 id="三、firmware-mod-kit-包含的工具的说明"><a href="#三、firmware-mod-kit-包含的工具的说明" class="headerlink" title="三、firmware-mod-kit 包含的工具的说明"></a>三、firmware-mod-kit 包含的工具的说明</h3><h3 id="Tools-Utilities"><a href="#Tools-Utilities" class="headerlink" title="Tools / Utilities"></a>Tools / Utilities</h3><p>The Firmware Mod Kit consists of a collection of tools useful when working with embedded firmware images. These include those listed below, though there are MANY MORE that are not listed here.<br>| |Tool | Description<br>| |:———|:—————-<br>| | AsusTRX | An extended version of ASUSTRX that can build both ‘normal’ TRX files and, optionally, those with an ASUS addver style header appended. It can also, uniquely, force segment offsets in the TRX (with -b switch) for compatibility with Marvell ASUS devices like the WL-530g. This tool replaces both ‘normal’ trx tool and addver. Current versions included are: 0.90 beta. <br>| | AddPattern | Utility to pre-pend Linksys style HDR0 header to a TRX. <br>| | AddVer | ASUS utility to append a header to a TRX image that contains version information. ASUSTRX includes this capability. Current version: unversioned. <br>| | Binwalk | Scans firmware images for known file types (firmware headers, compressed kernels, file systems, etc.) <br>| | CramFSCK | CRAMFS file system image checker and extractor. Current versions included are: 2.4x.<br> | | CramFSSwap | Utility to swap the endianess of a CramFS image <br>| | CRCalc | Utility to patch all uImage and TRX headers inside a given firmware image.<br>| | MkSquashFS | Builds a squashfs file system image. Current versions included are: 2.1-<a target="_blank" rel="noopener" href="https://code.google.com/p/firmware-mod-kit/source/detail?r=2">r2</a>, 3.0. <br>| | MkCramFS | Builds a cramfs file system image. Coming in next version. Current versions included are: 2.4x. <br>| | MotorolaBin | Utility that prepends 8 byte headers to TRX images for Motorola devices WR850G, WA840G, WE800G. Current version: unversioned. <br>| | Splitter3 | Utility to scan and extract a firmware image’s component parts. <br>| | Tpl-tool | Utility to manipulate TP-Link vendor format images. <br>| | UnCramFS | Alternate tool to extract a cramfs file system image. Use cramfsck instead whenever possible as it seems to be more reliable. Current versions included are: 0.7 (for cramfs v2.x). <br>| | UnCramFS-LZMA | Alternate tool to extract LZMA-compressed cramfs file system images, such as those used by OpenRG. <br>| | UnSquashFS | Extracts a zlib squashfs file system image. Current versions included are 1.0 for 3.0 images and 1.0 for 2.x images (my own blend). <br>| | UnSquashFS-LZMA | Extracts an lzma squashfs file system image. Current versions included are 1.0 for 3.0 images and 1.0 for 2.x images (my own blend). Note: Not all squashfs-lzma patches are compatible with one another. I’m working on adding support for all common squashfs-lzma variations. <br>| | UnTRX | Splits TRX style firmwares into their component parts. Also supports pre-pended addpattern HDR0 style headers. This was developed exclusively for this kit. Current versions included are: 0.45. <br>| | WebDecomp | Extracts and restores Web GUI files from DD-WRT firmware images, allowing modifications to the Web pages. <br>| | WRTVxImgTool | Utility to generate VxWorks compatible firmware images for the WRT54G(S) v5 series.</p>
<p>参考网址：<a target="_blank" rel="noopener" href="https://code.google.com/archive/p/firmware-mod-kit/wikis/Documentation.wiki">https://code.google.com/archive/p/firmware-mod-kit/wikis/Documentation.wiki</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Cyberangel</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://cyberangel.cn/2020/03/24/%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%86%E5%90%91%E5%88%86%E6%9E%90------firmware-mod-kit%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/">https://cyberangel.cn/2020/03/24/路由器逆向分析------firmware-mod-kit工具安装和使用说明/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://cyberangel.cn" target="_blank">Cyberangel-blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.png" target="_blank"><img class="post-qr-code-img" src="/img/alipay.png" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/03/24/%E8%B7%AF%E7%94%B1%E5%99%A8%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E6%8F%90%E5%8F%96/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">路由器文件系统与提取</div></div></a></div><div class="next-post pull-right"><a href="/2020/03/17/Delphi%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%EF%BC%88exe%EF%BC%89%E8%84%B1%E5%A3%B3/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Delphi可执行文件（exe）脱壳</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="disqus_thread"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#The-Firmware-Working-Directory"><span class="toc-number">1.</span> <span class="toc-text">The Firmware Working Directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Extracting-Firmware"><span class="toc-number">2.</span> <span class="toc-text">Extracting Firmware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Re-Building-Firmware"><span class="toc-number">3.</span> <span class="toc-text">Re-Building Firmware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Modifying-DD-WRT-Web-Pages"><span class="toc-number">4.</span> <span class="toc-text">Modifying DD-WRT Web Pages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reverting-to-a-vendor-firmware"><span class="toc-number">5.</span> <span class="toc-text">Reverting to a vendor firmware</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Examples"><span class="toc-number">6.</span> <span class="toc-text">Examples</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81firmware-mod-kit-%E5%8C%85%E5%90%AB%E7%9A%84%E5%B7%A5%E5%85%B7%E7%9A%84%E8%AF%B4%E6%98%8E"><span class="toc-number">7.</span> <span class="toc-text">三、firmware-mod-kit 包含的工具的说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Tools-Utilities"><span class="toc-number">8.</span> <span class="toc-text">Tools &#x2F; Utilities</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Cyberangel</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">为世界上所有美好而战！！！</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font-plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font-minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadDisqus () {
  var disqus_config = function () {
    this.page.url = 'https://cyberangel.cn/2020/03/24/%E8%B7%AF%E7%94%B1%E5%99%A8%E9%80%86%E5%90%91%E5%88%86%E6%9E%90------firmware-mod-kit%E5%B7%A5%E5%85%B7%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/'
    this.page.identifier = '2020/03/24/路由器逆向分析------firmware-mod-kit工具安装和使用说明/'
    this.page.title = '路由器逆向分析------firmware-mod-kit工具安装和使用说明'
  };

  window.disqusReset = () => {
    DISQUS.reset({
      reload: true,
      config: disqus_config
    })
  }

  if (window.DISQUS) disqusReset()
  else {
    (function() { 
      var d = document, s = d.createElement('script');
      s.src = 'https://.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
}

if ('Disqus' === 'Disqus' || !false) {
  if (false) btf.loadComment(document.getElementById('disqus_thread'), loadDisqus)
  else loadDisqus()
} else {
  function loadOtherComment () {
    loadDisqus()
  }
}
</script><script>if (window.DISQUSWIDGETS === undefined) {
  var d = document, s = d.createElement('script');
  s.src = 'https://.disqus.com/count.js';
  s.id = 'dsq-count-scr';
  (d.head || d.body).appendChild(s);
} else {
  DISQUSWIDGETS.getCount({reset: true});
}</script></div><canvas class="fireworks" mobile="true"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/fireworks.min.js"></script><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="false"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = true;
document.body.addEventListener('input', POWERMODE);
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>